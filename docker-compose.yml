  services:
    # PostgreSQL Database
    db:
      image: postgres:15-alpine
      environment:
        POSTGRES_USER: ${POSTGRES_USER}
        POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
        POSTGRES_DB: ${POSTGRES_DB}
      volumes:
        - postgres_data:/var/lib/postgresql/data
      ports:
        - "${DB_PORT}:5432"
      healthcheck:
        test: ["CMD-SHELL", "pg_isready -U ${POSTGRES_USER}"]
        interval: 5s
        timeout: 5s
        retries: 5

    # Backend API
    backend:
      build: ./backend
      ports:
        - "${BACKEND_PORT}:8000"
      environment:
        DB_HOST: db
        DB_PORT: 5432
        DB_NAME: ${POSTGRES_DB}
        DB_USER: ${POSTGRES_USER}
        DB_PASSWORD: ${POSTGRES_PASSWORD}
        PORT: 8000
        NODE_ENV: ${NODE_ENV}
      depends_on:
        db:
          condition: service_healthy

    # Frontend
    frontend:
      build: ./frontend
      ports:
        - "${FRONTEND_PORT}:80"
      environment:
        REACT_APP_API_URL: ${REACT_APP_API_URL}
      depends_on:
        - backend

  volumes:
    postgres_data: